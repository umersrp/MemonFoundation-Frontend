name: Deploy React App

on:
  push:
    branches:
      - main
      - dev

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸš€ Deploy to EC2
        uses: appleboy/ssh-action@v1.1.0
        with:
          host: ${{ secrets.EC2_HOST_MAIN }}
          username: ubuntu
          key: ${{ secrets.EC2_SSH_KEY }}
          script: |
            # Navigate to project directory based on branch
            if [[ "${{ github.ref_name }}" == "main" ]]; then
              echo "Deploying Production Build..."
              cd /repos/MemonFoundation-Frontend
              DEPLOY_DIR=/var/www/html/prod
            else
              echo "Deploying Development Build..."
              cd /repos/MemonFoundation-Frontend
              DEPLOY_DIR=/var/www/html/dev
            fi

            echo "Pulling latest changes..."
            git fetch origin
            git checkout ${{ github.ref_name }}
            git pull origin ${{ github.ref_name }}

            echo "Installing dependencies..."
            npm install --force

            echo "Building React app..."
            npm run build

            echo "Deploying build to $DEPLOY_DIR"
            sudo rm -rf $DEPLOY_DIR
            sudo mkdir -p $DEPLOY_DIR
            sudo cp -r dist/* $DEPLOY_DIR/

            echo "âœ… Deployment complete!"
